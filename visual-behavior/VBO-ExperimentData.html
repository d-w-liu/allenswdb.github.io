

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Visual Behavior Ophys Experiment Data &#8212; SWDB 2023 Data Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'visual-behavior/VBO-ExperimentData';</script>
    <link rel="canonical" href="https://allenswdb.github.io/visual-behavior/VBO-ExperimentData.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compare Trial Types" href="VBO-Tutorial-Compare_trial_types.html" />
    <link rel="prev" title="Visual Behavior Ophys Dataset" href="VBO-Dataset.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/cropped-SummerWorkshop_Header.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/cropped-SummerWorkshop_Header.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Data Book for Summer Workshop on the Dynamic Brain
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../background/background.html">Background</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../background/Mouse-visual-system.html">Mouse visual system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/transgenic-tools.html">Transgenic tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/experimental-setup.html">Behavioral apparatus</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../background/Neuropixels-electrophysiology.html">Extracellular electrophysiology</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../visual-coding-np/vcnp-quality-metrics.html">Unit Quality Metrics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../background/Two-photon-calcium-imaging.html">Calcium imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/Ophys-ephys-comparison.html">Ophys ephys comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/Optotagging.html">Optotagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../background/Intrinsic-Signal-Imaging.html">Intrinsic Signal Imaging</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visual-coding-2p/vc2p-background.html">Visual Coding — 2-photon</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-dataset.html">Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-session-data.html">Getting data from a session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-stimuli.html">Visual stimuli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-evoked-response.html">Exercise: Evoked response</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-cross-session-data.html">Cross session data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-2p/vc2p-analysis.html">Analysis files and cell specimens table</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visual-coding-np/vcnp.html">Visual Coding — Neuropixels</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-quickstart.html">Quick start guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-data-access.html">Accessing Neuropixels Visual Coding Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-units.html">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-receptive-fields.html">Receptive fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-lfp.html">Local field potential (LFP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-optotagging.html">Optotagging Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-session.html">Full example of accessing Visual Coding Neuropixels data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-cheatsheet.html">Cheat sheet for visual coding Neuropixels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visual-coding-np/vcnp-links.html">Other resources</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cell-type-lookup-table/ctlut-background.html">Cell Type Look-up Table</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-session-data.html">Session data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-optotagging.html">Optotagging</a></li>





<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-accessing-data.html">Accessing cell type lookup table data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cell-type-lookup-table/ctlut-identifying-tagged-units.html">Identifying tagged neurons</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="vb-background.html">Visual Behavior</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="VB-Behavior.html">Visual Behavior Task</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="VB-BehaviorSessionData.html">Behavior Session Data</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="VB-Ophys.html">Visual Behavior Ophys</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="VBO-Dataset.html">Visual Behavior Ophys Dataset</a></li>





<li class="toctree-l3 current active"><a class="current reference internal" href="#">Visual Behavior Ophys Experiment Data</a></li>

<li class="toctree-l3"><a class="reference internal" href="VBO-Tutorial-Compare_trial_types.html">Tutorial Comparing Trial Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBO-Tutorial-Downloading_data_and_exploring_the_manifest.html">Tutorial Downloading Data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="VB-Neuropixels.html">Visual Behavior Neuropixels</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="VBN-Dataset.html">Visual Behavior Neuropixels Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-SessionData.html">Visual Behavior Neuropixels Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Aligning_Neural_Data_to_Stimuli.html">Tutorial Aligning Neural Data to Stimuli</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Aligning_Behavior_Data_to_Task_Events.html">Tutorial Aligning Behavioral Data to Task Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="VBN-Tutorial-Analyzing_LFP_Data.html">Tutorial Analyzing LFP data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../microns-em/em-background.html">EM Connectomics</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-structural-data.html">Dataset Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/proofreading.html">Proofreading and Data Quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-neuroglancer.html">Neuroglancer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-dash-apps.html">Dash Apps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-caveclient-setup.html">Setting up CAVEclient</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-querying-tables.html">Programmatic Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/key-tables.html">Annotation Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-volume-data.html">Imagery and Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-skeletons.html">Skeletons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-meshes.html">Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-functional_data.html">MICrONS Functional Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-coordinates.html">Coordinate Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../microns-em/em-ultrastructure.html">Ultrastructure Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io/edit/main/databook/visual-behavior/VBO-ExperimentData.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/allenswdb/allenswdb.github.io/issues/new?title=Issue%20on%20page%20%2Fvisual-behavior/VBO-ExperimentData.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/visual-behavior/VBO-ExperimentData.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Visual Behavior Ophys Experiment Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Visual Behavior Ophys Experiment Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-cache-and-get-metadata-tables">Load the cache and get metadata tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-the-ophys-experiment-table-to-identify-experiments-of-interest">Filter the <code class="docutils literal notranslate"><span class="pre">ophys_experiment_table</span></code> to identify experiments of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data-for-one-experiment">Load data for one experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-metadata">Experiment metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#max-projection-image">Max projection image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-projection">Average projection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-specimen-table">Cell specimen table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#segmentation-mask-image">Segmentation mask image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-activity-traces">Cell activity traces</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#df-f-traces">dF/F traces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#events">Events</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ophys-timestamps">Ophys timestamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-presentations">Stimulus presentations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-templates">Stimulus templates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-timestamps">Stimulus timestamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lick-times">Lick times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewards">Rewards</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-speed">Running speed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eye-tracking">Eye tracking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-parameters">Task parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trials">Trials</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-metrics">Performance metrics</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-example-cell-activity-with-stimuli-and-behavior">Plot example cell activity with stimuli and behavior</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-plot-for-one-cell">Create the plot for one cell</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-same-plot-for-a-vip-cell-from-a-different-experiment">Create the same plot for a Vip cell from a different experiment</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="visual-behavior-ophys-experiment-data">
<h1>Visual Behavior Ophys Experiment Data<a class="headerlink" href="#visual-behavior-ophys-experiment-data" title="Permalink to this heading">#</a></h1>
<p>Below we we will learn how to load optical physiology and behavior data for one imaging plane from a Visual Behavior Ophys session using the AllenSDK. It describes the type of data available and shows a few simple ways of plotting calcium fluorescence traces along with the animal’s behavior and stimulus presentation times.</p>
<p>We need to import libraries for plotting and manipulating data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import allenSDK and check the version, which should be &gt;2.10.2</span>
<span class="kn">import</span> <span class="nn">allensdk</span>
<span class="n">allensdk</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2.15.2&#39;
</pre></div>
</div>
</div>
</div>
<section id="load-the-cache-and-get-metadata-tables">
<h2>Load the cache and get metadata tables<a class="headerlink" href="#load-the-cache-and-get-metadata-tables" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the behavior ophys project cache class from SDK to be able to load the data</span>
<span class="kn">from</span> <span class="nn">allensdk.brain_observatory.behavior.behavior_project_cache</span> <span class="kn">import</span> <span class="n">VisualBehaviorOphysProjectCache</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/allensdk/lib/python3.8/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the path to the dataset</span>
<span class="n">cache_dir</span> <span class="o">=</span> <span class="s1">&#39;/root/capsule/data/&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you are working with data in the cloud in Code Ocean,</span>
<span class="c1"># or if you have already downloaded the full dataset to your local machine,</span>
<span class="c1"># you can instantiate a local cache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">VisualBehaviorOphysProjectCache</span><span class="o">.</span><span class="n">from_local_cache</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">use_static_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># If you are working with the data locally for the first time, you need to instantiate the cache from S3:</span>
<span class="c1"># cache = VisualBehaviorOphysProjectCache.from_s3_cache(cache_dir=cache_dir)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get metadata tables</span>
<span class="n">behavior_session_table</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_behavior_session_table</span><span class="p">()</span>
<span class="n">ophys_session_table</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_ophys_session_table</span><span class="p">()</span>
<span class="n">ophys_experiment_table</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_ophys_experiment_table</span><span class="p">()</span>

<span class="c1">#print number of items in each table for all imaging and behavioral sessions</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of behavior sessions = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">behavior_session_table</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of ophys sessions = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ophys_session_table</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of ophys experiments = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ophys_experiment_table</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of behavior sessions = 4787
Number of ophys sessions = 705
Number of ophys experiments = 1941
</pre></div>
</div>
</div>
</div>
<p>The term <b>ophys experiment</b> is used to describe one imaging plane during one <b>ophys session</b>. Each ophys session can contain one or more ophys experiments (imaging planes) depending on which microscope was used.</p>
<p>For datasets acquired using a single-plane imaging microscope (<code class="docutils literal notranslate"><span class="pre">equipment_name</span></code> = <code class="docutils literal notranslate"><span class="pre">CAMP#.#</span></code>), there will be only 1 <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code> per <code class="docutils literal notranslate"><span class="pre">ophys_session_id</span></code>. For sessions acquired with the multi-plane Mesoscope (<code class="docutils literal notranslate"><span class="pre">equipment_name</span></code> = <code class="docutils literal notranslate"><span class="pre">MESO.#</span></code>), there can be up to 8 ophys experiments (i.e. imaging planes) associated with that session.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ophys_session_table</span></code> contains metadata for each imaging session and is organized by the <code class="docutils literal notranslate"><span class="pre">ophys_session_id</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ophys_experiment_table</span></code> contains metadata for each imaging plane in each session and is organized by the <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code>. This table includes all the metadata provided by the <code class="docutils literal notranslate"><span class="pre">ophys_session_table</span></code>, as well as information specific to the imaging plane, such as the <code class="docutils literal notranslate"><span class="pre">imaging_depth</span></code> and <code class="docutils literal notranslate"><span class="pre">targeted_structure</span></code>.</p>
<p>A single imaging plane (aka ophys experiment) is linked across sessions using the <code class="docutils literal notranslate"><span class="pre">ophys_container_id</span></code>. An <b>ophys container</b> can contain a variable number of <code class="docutils literal notranslate"><span class="pre">ophys_experiment_ids</span></code> depending on which <code class="docutils literal notranslate"><span class="pre">session_types</span></code> were acquired for that imaging plane, and which passed quality control checks.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">behavior_session_table</span></code> contains metadata related to the full training history of each mouse and is organized by the <code class="docutils literal notranslate"><span class="pre">behavior_session_id</span></code>. Some <b>behavior sessions</b> took place under the 2-photon microscope (<code class="docutils literal notranslate"><span class="pre">session_type</span></code> beginning with <code class="docutils literal notranslate"><span class="pre">OPHYS_</span></code>) and will have an associated <code class="docutils literal notranslate"><span class="pre">ophys_session_id</span></code> if the ophys data passed quality control and is available for analysis.</p>
<p>Some ophys sessions may not pass quality control, but the behavior data is still provided in the <code class="docutils literal notranslate"><span class="pre">behavior_session_table</span></code>. These sessions will have a <code class="docutils literal notranslate"><span class="pre">session_type</span></code> beginning with <code class="docutils literal notranslate"><span class="pre">OPHYS_</span></code> but will not have an associated <code class="docutils literal notranslate"><span class="pre">ophys_session_id</span></code>.</p>
<p>In this notebook, we will use the <code class="docutils literal notranslate"><span class="pre">ophys_experiment_table</span></code> to select experiments of interest and look at them in a greater detail.</p>
<section id="filter-the-ophys-experiment-table-to-identify-experiments-of-interest">
<h3>Filter the <code class="docutils literal notranslate"><span class="pre">ophys_experiment_table</span></code> to identify experiments of interest<a class="headerlink" href="#filter-the-ophys-experiment-table-to-identify-experiments-of-interest" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s print a sample of 5 rows to see what&#39;s in the table</span>
<span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>equipment_name</th>
      <th>full_genotype</th>
      <th>mouse_id</th>
      <th>reporter_line</th>
      <th>driver_line</th>
      <th>sex</th>
      <th>age_in_days</th>
      <th>cre_line</th>
      <th>indicator</th>
      <th>session_number</th>
      <th>...</th>
      <th>ophys_container_id</th>
      <th>project_code</th>
      <th>imaging_depth</th>
      <th>targeted_structure</th>
      <th>date_of_acquisition</th>
      <th>session_type</th>
      <th>experience_level</th>
      <th>passive</th>
      <th>image_set</th>
      <th>file_id</th>
    </tr>
    <tr>
      <th>ophys_experiment_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>977975798</th>
      <td>MESO.1</td>
      <td>Slc17a7-IRES2-Cre/wt;Camk2a-tTA/wt;Ai93(TITL-G...</td>
      <td>484408</td>
      <td>Ai93(TITL-GCaMP6f)</td>
      <td>[Slc17a7-IRES2-Cre, Camk2a-tTA]</td>
      <td>M</td>
      <td>121.0</td>
      <td>Slc17a7-IRES2-Cre</td>
      <td>GCaMP6f</td>
      <td>4.0</td>
      <td>...</td>
      <td>1018027759</td>
      <td>VisualBehaviorMultiscope4areasx2d</td>
      <td>163</td>
      <td>VISal</td>
      <td>2019-11-06 08:27:13.524215</td>
      <td>OPHYS_4_images_H</td>
      <td>Novel 1</td>
      <td>False</td>
      <td>H</td>
      <td>1120141284</td>
    </tr>
    <tr>
      <th>849233400</th>
      <td>MESO.1</td>
      <td>Vip-IRES-Cre/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>438912</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
      <td>[Vip-IRES-Cre]</td>
      <td>M</td>
      <td>129.0</td>
      <td>Vip-IRES-Cre</td>
      <td>GCaMP6f</td>
      <td>4.0</td>
      <td>...</td>
      <td>1018027862</td>
      <td>VisualBehaviorMultiscope</td>
      <td>150</td>
      <td>VISl</td>
      <td>2019-04-10 11:22:28.314537</td>
      <td>OPHYS_4_images_B</td>
      <td>Novel 1</td>
      <td>False</td>
      <td>B</td>
      <td>1085398514</td>
    </tr>
    <tr>
      <th>964615743</th>
      <td>MESO.1</td>
      <td>Slc17a7-IRES2-Cre/wt;Camk2a-tTA/wt;Ai93(TITL-G...</td>
      <td>472271</td>
      <td>Ai93(TITL-GCaMP6f)</td>
      <td>[Slc17a7-IRES2-Cre, Camk2a-tTA]</td>
      <td>M</td>
      <td>154.0</td>
      <td>Slc17a7-IRES2-Cre</td>
      <td>GCaMP6f</td>
      <td>6.0</td>
      <td>...</td>
      <td>1018027721</td>
      <td>VisualBehaviorMultiscope4areasx2d</td>
      <td>183</td>
      <td>VISp</td>
      <td>2019-10-09 10:44:31.238545</td>
      <td>OPHYS_6_images_H</td>
      <td>Novel &gt;1</td>
      <td>False</td>
      <td>H</td>
      <td>1120140412</td>
    </tr>
    <tr>
      <th>956903375</th>
      <td>CAM2P.5</td>
      <td>Sst-IRES-Cre/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>470784</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
      <td>[Sst-IRES-Cre]</td>
      <td>F</td>
      <td>150.0</td>
      <td>Sst-IRES-Cre</td>
      <td>GCaMP6f</td>
      <td>2.0</td>
      <td>...</td>
      <td>941373529</td>
      <td>VisualBehaviorTask1B</td>
      <td>275</td>
      <td>VISp</td>
      <td>2019-09-26 17:34:33.000000</td>
      <td>OPHYS_2_images_B_passive</td>
      <td>Familiar</td>
      <td>True</td>
      <td>B</td>
      <td>957356891</td>
    </tr>
    <tr>
      <th>1010092804</th>
      <td>MESO.1</td>
      <td>Vip-IRES-Cre/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>499478</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
      <td>[Vip-IRES-Cre]</td>
      <td>F</td>
      <td>140.0</td>
      <td>Vip-IRES-Cre</td>
      <td>GCaMP6f</td>
      <td>2.0</td>
      <td>...</td>
      <td>1018027806</td>
      <td>VisualBehaviorMultiscope4areasx2d</td>
      <td>267</td>
      <td>VISl</td>
      <td>2020-02-24 08:41:59.392974</td>
      <td>OPHYS_2_images_G_passive</td>
      <td>Familiar</td>
      <td>True</td>
      <td>G</td>
      <td>1120142312</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div></div>
</div>
<p>You can get <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code>s corresponding to specific experimental conditions by filtering the table using the columns. Here, we can select experiments from mice from the Sst-IRES-Cre <a class="reference internal" href="../glossary.html#term-Driver-line"><span class="xref std std-term">Driver Line</span></a>, also called a {term}’Cre line’, as well as filter by <code class="docutils literal notranslate"><span class="pre">session_number</span></code> to identify experiments from the first session with the novel images, which always has a <code class="docutils literal notranslate"><span class="pre">session_type</span></code> starting with <code class="docutils literal notranslate"><span class="pre">OPHYS_4</span></code>, and can be identified using the abbreviated <code class="docutils literal notranslate"><span class="pre">session_number</span></code> column which is agnostic to which specific image set was used). You can use the <code class="docutils literal notranslate"><span class="pre">prior_exposures_to_image_set</span></code> column to ensure that the session was truly the first day with the novel image set, and not a retake of the same <code class="docutils literal notranslate"><span class="pre">session_type</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all Sst experiments for ophys session 4</span>
<span class="n">selected_experiment_table</span> <span class="o">=</span> <span class="n">ophys_experiment_table</span><span class="p">[(</span><span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">cre_line</span><span class="o">==</span><span class="s1">&#39;Sst-IRES-Cre&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">session_number</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">prior_exposures_to_image_set</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of experiments: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_experiment_table</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of experiments: 58
</pre></div>
</div>
</div>
</div>
<p>Remember that any given experiment (defined by its <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code>) contains data from only one imaging plane, in one session. There can be multiple experiments (imaging planes) recorded in the same imaging session if the multi-plane 2-photon microscope was used, but there can never be multiple sessions for a given <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code>.</p>
<p>Here, we can check how many unique imaging sessions are associated with experiments selected above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of unique sessions: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_experiment_table</span><span class="p">[</span><span class="s1">&#39;ophys_session_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of unique sessions: 19
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="load-data-for-one-experiment">
<h2>Load data for one experiment<a class="headerlink" href="#load-data-for-one-experiment" title="Permalink to this heading">#</a></h2>
<p>Let’s pick an experiment from the table and plot example ophys and behavioral data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select first experiment from the table to look at in more detail.</span>
<span class="n">ophys_experiment_id</span> <span class="o">=</span> <span class="n">selected_experiment_table</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># load the data for this ophys experiment from the cache</span>
<span class="n">ophys_experiment</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_behavior_ophys_experiment</span><span class="p">(</span><span class="n">ophys_experiment_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/allensdk/lib/python3.8/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace &#39;hdmf-common&#39; version 1.3.0 because version 1.5.1 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
/opt/envs/allensdk/lib/python3.8/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace &#39;core&#39; version 2.2.5 because version 2.5.0 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_behavior_ophys_experiment()</span></code> method returns a python object containing all data and metadata for the provided <code class="docutils literal notranslate"><span class="pre">ophys_experiment_id</span></code>.</p>
<p>What are the attributes of the <code class="docutils literal notranslate"><span class="pre">ophys_experiment</span></code> object?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get all attributes &amp; methods</span>
<span class="n">attributes</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">list_data_attributes_and_methods</span><span class="p">()</span>
<span class="c1"># Let&#39;s focus on attribtues for now, remove the methods, which start with &quot;get&quot;</span>
<span class="p">[</span><span class="n">attribute</span> <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="s1">&#39;get&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attribute</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;average_projection&#39;,
 &#39;behavior_session_id&#39;,
 &#39;cell_specimen_table&#39;,
 &#39;corrected_fluorescence_traces&#39;,
 &#39;demixed_traces&#39;,
 &#39;dff_traces&#39;,
 &#39;events&#39;,
 &#39;eye_tracking&#39;,
 &#39;eye_tracking_rig_geometry&#39;,
 &#39;licks&#39;,
 &#39;max_projection&#39;,
 &#39;metadata&#39;,
 &#39;motion_correction&#39;,
 &#39;neuropil_traces&#39;,
 &#39;ophys_experiment_id&#39;,
 &#39;ophys_session_id&#39;,
 &#39;ophys_timestamps&#39;,
 &#39;raw_running_speed&#39;,
 &#39;rewards&#39;,
 &#39;roi_masks&#39;,
 &#39;running_speed&#39;,
 &#39;segmentation_mask_image&#39;,
 &#39;stimulus_presentations&#39;,
 &#39;stimulus_templates&#39;,
 &#39;stimulus_timestamps&#39;,
 &#39;task_parameters&#39;,
 &#39;trials&#39;]
</pre></div>
</div>
</div>
</div>
<p>Note that any attribute can be followed by a <code class="docutils literal notranslate"><span class="pre">?</span></code> in a Jupyter Notebook to see the docstring. For example, running the cell below will make a frame appear at the bottom of your browser with the docstring for the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ophys_experiment.metadata<span class="o">?</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="experiment-metadata">
<h2>Experiment metadata<a class="headerlink" href="#experiment-metadata" title="Permalink to this heading">#</a></h2>
<p>Get the metadata for this experiment using the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> attribute of the OphysExperiment class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;equipment_name&#39;: &#39;MESO.1&#39;,
 &#39;sex&#39;: &#39;F&#39;,
 &#39;age_in_days&#39;: 233,
 &#39;stimulus_frame_rate&#39;: 60.0,
 &#39;session_type&#39;: &#39;OPHYS_4_images_B&#39;,
 &#39;date_of_acquisition&#39;: datetime.datetime(2019, 9, 27, 8, 28, 5, tzinfo=tzlocal()),
 &#39;reporter_line&#39;: &#39;Ai148(TIT2L-GC6f-ICL-tTA2)&#39;,
 &#39;cre_line&#39;: &#39;Sst-IRES-Cre&#39;,
 &#39;behavior_session_uuid&#39;: UUID(&#39;40897cd4-3279-4a2d-b65d-b3f984e34e17&#39;),
 &#39;driver_line&#39;: [&#39;Sst-IRES-Cre&#39;],
 &#39;mouse_id&#39;: &#39;457841&#39;,
 &#39;project_code&#39;: &#39;Not Available&#39;,
 &#39;full_genotype&#39;: &#39;Sst-IRES-Cre/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt&#39;,
 &#39;behavior_session_id&#39;: 957032492,
 &#39;indicator&#39;: &#39;GCaMP6f&#39;,
 &#39;emission_lambda&#39;: 520.0,
 &#39;excitation_lambda&#39;: 910.0,
 &#39;ophys_container_id&#39;: None,
 &#39;field_of_view_height&#39;: 512,
 &#39;field_of_view_width&#39;: 512,
 &#39;imaging_depth&#39;: None,
 &#39;targeted_imaging_depth&#39;: None,
 &#39;imaging_plane_group&#39;: 2,
 &#39;imaging_plane_group_count&#39;: 4,
 &#39;ophys_experiment_id&#39;: 957759570,
 &#39;ophys_frame_rate&#39;: 11.0,
 &#39;ophys_session_id&#39;: 957020350,
 &#39;targeted_structure&#39;: &#39;VISl&#39;}
</pre></div>
</div>
</div>
</div>
<p>Here you can see that this experiment was in Sst Cre line, in a female mouse at 233 days old, recorded using mesoscope, at an imaging depth of 150 microns, in primary visual cortex (VISp). This experiment is also from OPHYS 1 session using image set A.</p>
<dl class="simple myst">
<dt>age_in_days</dt><dd><p>(int) age of mouse in days</p>
</dd>
<dt>behavior_session_id</dt><dd><p>(int)	unique identifier for a behavior session</p>
</dd>
<dt>behavior_session_uuid</dt><dd><p>(uuid)  unique identifier for a behavior session</p>
</dd>
<dt>cre_line</dt><dd><p>(string) cre driver line for a transgenic mouse</p>
</dd>
<dt>date_of_acquisition</dt><dd><p>(date time object) date and time of experiment acquisition, yyyy-mm-dd hh:mm:ss.</p>
</dd>
<dt>driver_line</dt><dd><p>(list of string) all driver lines for transgenic mouse</p>
</dd>
</dl>
<p>emission_lambda:
(float) wavelength (in nanometers) the 2 photon microscope is tuned to based on transgenic reporter line</p>
<dl class="simple myst">
<dt>equipment_name</dt><dd><p>(string) identifier for equipment data was collected on</p>
</dd>
<dt>excitation_lambda</dt><dd><p>(float 64) wavelength (in nanometers) of the two photon laser</p>
</dd>
<dt>experiment_container_id</dt><dd><p>(int) unique identifier for a container</p>
</dd>
<dt>field_of_view_height</dt><dd><p>(int) field of view height in pixels</p>
</dd>
<dt>field_of_view_width</dt><dd><p>(int) field of view width in pixels</p>
</dd>
<dt>full_genotype</dt><dd><p>(string) full genotype of transgenic mouse</p>
</dd>
<dt>imaging_depth</dt><dd><p>(int) depth in microns from the cortical surface, where the data was collected</p>
</dd>
<dt>imaging_plane_group</dt><dd><p>(none or int) a grouping number assigned to paired planes (experiments) that were simultaneously recorded, applies to mesoscope sessions only</p>
</dd>
<dt>imaging_plane_group_count</dt><dd><p>(int) total number of imaging plane groups for a mesoscope session</p>
</dd>
<dt>mouse_id</dt><dd><p>(int)	unique identifier for a mouse</p>
</dd>
<dt>ophys_experiment_id</dt><dd><p>(int) unique identifier for an ophys experiment, corresponding to one imaging plane in one recording session</p>
</dd>
<dt>ophys_frame_rate</dt><dd><p>(float 64) rate (in Hz) that the two photon microscope collected frames for an individual imaging plane / field of view</p>
</dd>
<dt>ophys_session_id</dt><dd><p>(int) unique identifier for a ophys session</p>
</dd>
<dt>reporter_line</dt><dd><p>(string) reporter line for transgenic mouse</p>
</dd>
<dt>session_type</dt><dd><p>(string) visual stimulus type displayed during behavior session</p>
</dd>
<dt>sex</dt><dd><p>(string)	sex of the mouse</p>
</dd>
<dt>stimulus_frame_rate</dt><dd><p>(float) frame rate (Hz) at which the visual stimulus is displayed</p>
</dd>
<dt>targeted_structure</dt><dd><p>(string) brain area targeted for the imaging plane in this experiment</p>
</dd>
</dl>
</section>
<section id="max-projection-image">
<h2>Max projection image<a class="headerlink" href="#max-projection-image" title="Permalink to this heading">#</a></h2>
<p>Plot the maximum intensity projection image for this imaging plane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">max_projection</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fc62969f7c0&gt;
</pre></div>
</div>
<img alt="../_images/748fca2ea919d913e759cfd2faf29704833e733c320d883dde66081697229442.png" src="../_images/748fca2ea919d913e759cfd2faf29704833e733c320d883dde66081697229442.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">max_projection</span></code> is a 2D image of the maximum intensity value for each pixel across the entire 2-photon movie recorded during an imaging session. Plotting the max projection can give you a sense of how many neurons were visible during imaging and how clear and stable the imaging session was.</p>
</section>
<section id="average-projection">
<h2>Average projection<a class="headerlink" href="#average-projection" title="Permalink to this heading">#</a></h2>
<p>Plot the average projection image for this imaging plane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">average_projection</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fc62ac358e0&gt;
</pre></div>
</div>
<img alt="../_images/7651e48a8f95296fceb102c4819441c60df26c7565fc28379e757e010a6414cc.png" src="../_images/7651e48a8f95296fceb102c4819441c60df26c7565fc28379e757e010a6414cc.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">average_projection</span></code> is a2D image of the microscope field of view, averaged across the session.</p>
</section>
<section id="cell-specimen-table">
<h2>Cell specimen table<a class="headerlink" href="#cell-specimen-table" title="Permalink to this heading">#</a></h2>
<p>Examine the <code class="docutils literal notranslate"><span class="pre">cell_specimen_table</span></code> which contains metadata about each segmented neuron.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">cell_specimen_table</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell_roi_id</th>
      <th>height</th>
      <th>mask_image_plane</th>
      <th>max_correction_down</th>
      <th>max_correction_left</th>
      <th>max_correction_right</th>
      <th>max_correction_up</th>
      <th>valid_roi</th>
      <th>width</th>
      <th>x</th>
      <th>y</th>
      <th>roi_mask</th>
    </tr>
    <tr>
      <th>cell_specimen_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1086610383</th>
      <td>1080722726</td>
      <td>31</td>
      <td>1</td>
      <td>6.0</td>
      <td>10.0</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>True</td>
      <td>35</td>
      <td>25</td>
      <td>82</td>
      <td>[[False, False, False, False, False, False, Fa...</td>
    </tr>
    <tr>
      <th>1086607340</th>
      <td>1080722703</td>
      <td>19</td>
      <td>1</td>
      <td>6.0</td>
      <td>10.0</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>True</td>
      <td>19</td>
      <td>230</td>
      <td>168</td>
      <td>[[False, False, False, False, False, False, Fa...</td>
    </tr>
    <tr>
      <th>1086610696</th>
      <td>1080722847</td>
      <td>18</td>
      <td>0</td>
      <td>6.0</td>
      <td>10.0</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>True</td>
      <td>13</td>
      <td>393</td>
      <td>199</td>
      <td>[[False, False, False, False, False, False, Fa...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<dl class="simple myst">
<dt>cell_specimen_id [index]</dt><dd><p>(int) unified id of segmented cell across experiments (assigned after cell matching)</p>
</dd>
<dt>cell_roi_id</dt><dd><p>(int) experiment specific id of segmented roi (assigned before cell matching)</p>
</dd>
<dt>roi_mask</dt><dd><p>(array of bool) an image array that displays the location of the roi mask in the field of view</p>
</dd>
<dt>valid_roi</dt><dd><p>(bool) indicates if cell classification found the segmented ROI to be a cell or not (True = cell, False = not cell). Only valid cells are provided  in the released dataset.</p>
</dd>
<dt>width</dt><dd><p>(int) width of ROI in pixels</p>
</dd>
<dt>height</dt><dd><p>(int) height of ROI/cell in pixels</p>
</dd>
<dt>x</dt><dd><p>(float) x position of ROI in field of view in pixels (top left corner)</p>
</dd>
<dt>y</dt><dd><p>(float) y position of ROI in field of view in pixels (top left corner)</p>
</dd>
<dt>mask_image_plane</dt><dd><p>(int) which image plane an ROI resides on. Overlapping ROIs are stored on different mask image planes</p>
</dd>
<dt>max_corretion_down</dt><dd><p>(float) max motion correction in down direction in pixels</p>
</dd>
<dt>max_correction_left</dt><dd><p>(float) max motion correction in left direction in pixels</p>
</dd>
<dt>max_correction_right</dt><dd><p>(float) max motion correction in right direction in pixels</p>
</dd>
<dt>max_correction_up</dt><dd><p>(float) max motion correction in up direction in pixels</p>
</dd>
</dl>
<p>What do the ROI masks look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot one ROI mask</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">cell_specimen_table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;roi_mask&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fc62ac21bb0&gt;
</pre></div>
</div>
<img alt="../_images/59163eb551c85939082a151a729c41d6f1e43a2ea0646fdcd64df1a4f1791463.png" src="../_images/59163eb551c85939082a151a729c41d6f1e43a2ea0646fdcd64df1a4f1791463.png" />
</div>
</div>
</section>
<section id="segmentation-mask-image">
<h2>Segmentation mask image<a class="headerlink" href="#segmentation-mask-image" title="Permalink to this heading">#</a></h2>
<p>A 2D image of all segmented ROIs can be viewed using the <code class="docutils literal notranslate"><span class="pre">segmentation_mask_image</span></code> attribute.</p>
<p>segmentation_mask_image</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">segmentation_mask_image</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fc62a8c7760&gt;
</pre></div>
</div>
<img alt="../_images/da1a1cc1279f98620fa6871c4fdbfaf03edb93f7b0f193329ab7bd9706c237a4.png" src="../_images/da1a1cc1279f98620fa6871c4fdbfaf03edb93f7b0f193329ab7bd9706c237a4.png" />
</div>
</div>
</section>
<section id="cell-activity-traces">
<h2>Cell activity traces<a class="headerlink" href="#cell-activity-traces" title="Permalink to this heading">#</a></h2>
<p>There are several versions of cell activity traces, corresponding to different stages of the data processing pipeline.</p>
<p><b>cell activity traces recorded on the single-plane Scientifica microscopes are sampled at 30Hz, while cell activity recorded on the multi-plane Mesoscope are recorded at 11Hz</b></p>
<p>After ROIs are segmented, the average fluorescence value within the ROI is computed for each frame of the 2-photon movie, resulting in a trace of raw fluorescence over time, in arbitrary units. A fluorescence trace for the region surrounding the ROI, containing neuropil and other cell bodies, is computed and subtracted from the raw fluorescence of the cell to remove contamination from surrounding pixels. If two ROIs are overlapping with each other, they are demixed to ensure that the fluorescence signal is attributed to the correct ROI.</p>
<p>The neuropil corrected, demixed traces, called <code class="docutils literal notranslate"><span class="pre">corrected_fluorescence_traces</span></code> are then baseline subtracted and normalized to produce <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> which provide a fractional change in fluorescence over time relative to the ROI’s baseline fluorescence. These are the cell activity traces that are typically used for analysis.</p>
<p>Finally, an event detection algorithm is run on the <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> to determine the time and magnitude of calcium <code class="docutils literal notranslate"><span class="pre">events</span></code> and reduce potential confounds arising from features of the calcium indicator. More specifically, the binding kinetics of the calcium indicator GCaMP6 result in a fast rise in fluorescence following spiking activity, but a much slower decay time. This slow decay of the calcium signal can cause problems some types of analysis because repeated bursts of action potentials can cause the calcium signal to summate, resulting in a magnitude that is no longer proportional to the cell’s activity. The deconvolved <code class="docutils literal notranslate"><span class="pre">events</span></code> remove contamination due to this slow decay, and are useful in cases where timing precision is particularly important.</p>
<p>The dataframes provided for <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code>, <code class="docutils literal notranslate"><span class="pre">events</span></code>, <code class="docutils literal notranslate"><span class="pre">corrected_fluorescence_traces</span></code>, <code class="docutils literal notranslate"><span class="pre">demixed_traces</span></code>, and <code class="docutils literal notranslate"><span class="pre">neuropil_traces</span></code> all share the same index, the <code class="docutils literal notranslate"><span class="pre">cell_specimen_id</span></code> and one column, the <code class="docutils literal notranslate"><span class="pre">cell_roi_id</span></code>.</p>
<dl class="simple myst">
<dt>cell_specimen_id [index]</dt><dd><p>(int) unified ID of segmented cell across experiments (assigned after cell matching)</p>
</dd>
<dt>cell_roi_id</dt><dd><p>(int) experiment specific ID of segmented cell (assigned before cell matching)</p>
</dd>
</dl>
<p>The unique columns of the two most important types of traces, <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> and <code class="docutils literal notranslate"><span class="pre">events</span></code> are described below.</p>
<section id="df-f-traces">
<h3>dF/F traces<a class="headerlink" href="#df-f-traces" title="Permalink to this heading">#</a></h3>
<p>Examine <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> for the first 10 cells this experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">dff_traces</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell_roi_id</th>
      <th>dff</th>
    </tr>
    <tr>
      <th>cell_specimen_id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1086607071</th>
      <td>1080722688</td>
      <td>[0.2915222644805908, 0.43415918946266174, 0.50...</td>
    </tr>
    <tr>
      <th>1086607143</th>
      <td>1080722691</td>
      <td>[0.13391682505607605, 0.29041922092437744, 0.2...</td>
    </tr>
    <tr>
      <th>1086607340</th>
      <td>1080722703</td>
      <td>[0.25876128673553467, 0.28472623229026794, 0.2...</td>
    </tr>
    <tr>
      <th>1086607562</th>
      <td>1080722713</td>
      <td>[0.33256980776786804, 0.3811415135860443, 0.15...</td>
    </tr>
    <tr>
      <th>1086608432</th>
      <td>1080722725</td>
      <td>[0.6332074403762817, 0.8515550494194031, 0.342...</td>
    </tr>
    <tr>
      <th>1086610383</th>
      <td>1080722726</td>
      <td>[0.21246589720249176, 0.18863870203495026, 0.1...</td>
    </tr>
    <tr>
      <th>1086607814</th>
      <td>1080722743</td>
      <td>[0.19181318581104279, 0.1326054036617279, 0.28...</td>
    </tr>
    <tr>
      <th>1086608913</th>
      <td>1080722764</td>
      <td>[0.01678711175918579, 0.27544718980789185, 0.1...</td>
    </tr>
    <tr>
      <th>1086608195</th>
      <td>1080722771</td>
      <td>[2.041205883026123, 0.9304129481315613, 0.6569...</td>
    </tr>
    <tr>
      <th>1086607431</th>
      <td>1080722776</td>
      <td>[0.22929009795188904, 0.4735485315322876, 0.21...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<dl class="simple myst">
<dt>dff</dt><dd><p>(list of float) fractional fluorescence values relative to baseline (arbitrary units). Each value corresponds to one frame of the 2-photon movie.</p>
</dd>
</dl>
<p>If you don’t want dff in a pandas dataframe format, you can convert <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> to an array, using the <code class="docutils literal notranslate"><span class="pre">np.vstack</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dff_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">dff_traces</span><span class="o">.</span><span class="n">dff</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This array contrains dff traces from </span><span class="si">{}</span><span class="s1"> neurons and it is </span><span class="si">{}</span><span class="s1"> samples long.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dff_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dff_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This array contrains dff traces from 23 neurons and it is 48284 samples long.
</pre></div>
</div>
</div>
</div>
</section>
<section id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">events</span></code> are computed for each cell as described in <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/30652683/">Giovannucci et al. 2019</a>. The magnitude of events approximates the firing rate of neurons with the resolusion of about 200 ms. The biggest advantage of using events over dff traces is they exclude prolonged calcium transients that may conteminate neural responses to subsequent stimuli. You can also use <code class="docutils literal notranslate"><span class="pre">filtered_events</span></code> which are events convolved with a filter created using <code class="docutils literal notranslate"><span class="pre">stats.halfnorm</span></code> method to generate a more continuous trace of activity.</p>
<p>Examine <code class="docutils literal notranslate"><span class="pre">events</span></code> for the first 10 cells this experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell_roi_id</th>
      <th>events</th>
      <th>filtered_events</th>
      <th>lambda</th>
      <th>noise_std</th>
    </tr>
    <tr>
      <th>cell_specimen_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1086607071</th>
      <td>1080722688</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.1599</td>
      <td>0.124335</td>
    </tr>
    <tr>
      <th>1086607143</th>
      <td>1080722691</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.0762</td>
      <td>0.085989</td>
    </tr>
    <tr>
      <th>1086607340</th>
      <td>1080722703</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.0832</td>
      <td>0.089782</td>
    </tr>
    <tr>
      <th>1086607562</th>
      <td>1080722713</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.0477</td>
      <td>0.069837</td>
    </tr>
    <tr>
      <th>1086608432</th>
      <td>1080722725</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.1886</td>
      <td>0.134772</td>
    </tr>
    <tr>
      <th>1086610383</th>
      <td>1080722726</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.0431</td>
      <td>0.064415</td>
    </tr>
    <tr>
      <th>1086607814</th>
      <td>1080722743</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.0917</td>
      <td>0.094015</td>
    </tr>
    <tr>
      <th>1086608913</th>
      <td>1080722764</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.1034</td>
      <td>0.099846</td>
    </tr>
    <tr>
      <th>1086608195</th>
      <td>1080722771</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.9085</td>
      <td>0.295720</td>
    </tr>
    <tr>
      <th>1086607431</th>
      <td>1080722776</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, ...</td>
      <td>0.1025</td>
      <td>0.099387</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Column definitions:</p>
<dl class="simple myst">
<dt>events</dt><dd><p>(np.array of float) event trace where events correspond to the rise time of a calcium transient in the dF/F trace, with a magnitude roughly proportional the magnitude of the increase in dF/F. Each value corresponds to one frame of the 2-photon movie.</p>
</dd>
<dt>filtered_events</dt><dd><p>(np.array of float) Events array with a 1d causal half-gaussian filter to smooth it for visualization. Uses a halfnorm distribution as weights to the filter</p>
</dd>
<dt>lambdas</dt><dd><p>(float64) regularization value selected to make the minimum event size be close to N * noise_std. Computed from Poisson distribution of events in the trace (can be thought of as a center of mass of the distribution, larger lambda == higher “firing rate”)</p>
</dd>
<dt>noise_stds</dt><dd><p>(float64) estimated noise standard deviation for the events trace</p>
</dd>
</dl>
</section>
</section>
<section id="ophys-timestamps">
<h2>Ophys timestamps<a class="headerlink" href="#ophys-timestamps" title="Permalink to this heading">#</a></h2>
<p>The timestamps are the same for <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> and <code class="docutils literal notranslate"><span class="pre">events</span></code>, measured in seconds</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   8.77128,    8.86448,    8.95768, ..., 4510.0275 , 4510.12074,
       4510.21397])
</pre></div>
</div>
</div>
</div>
<p>Each frame of the 2-photon movie is assigned a timestamp, thus the length of <code class="docutils literal notranslate"><span class="pre">ophys_timestamps</span></code> should be equal to the length of <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> and <code class="docutils literal notranslate"><span class="pre">events</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;length of timestamps: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;length of dff_traces: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">dff_traces</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dff&#39;</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;length of events: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;events&#39;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>length of timestamps: 48284
length of dff_traces: 48284
length of events: 48284
</pre></div>
</div>
</div>
</div>
<p>Plot <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> and <code class="docutils literal notranslate"><span class="pre">events</span></code> for one cell</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get list of cell_specimen_ids using the index of cell_specimen_table</span>
<span class="n">cell_specimen_ids</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">cell_specimen_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">cell_specimen_id</span> <span class="o">=</span> <span class="n">cell_specimen_ids</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot dff and events traces overlaid from the cell selected above</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span><span class="p">,</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">dff_traces</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cell_specimen_id</span><span class="p">,</span> <span class="s1">&#39;dff&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;dff&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span><span class="p">,</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cell_specimen_id</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;events&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;trace magnitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;cell_specimen_id = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_specimen_id</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc629869fa0&gt;
</pre></div>
</div>
<img alt="../_images/ecb6b0d097e8d2f35a462385bf397de241e6cb3ea9493b2b46bb394d3851484d.png" src="../_images/ecb6b0d097e8d2f35a462385bf397de241e6cb3ea9493b2b46bb394d3851484d.png" />
</div>
</div>
<p>We can see that as expected, events trace is much cleaner than dff and it generally follows big Ca transients really well. We can also see that this cell was not very active during our experiment. Each experiment has a 5 minute movie at the end, which often drives neural activity really well. We can see a notable increase in cell’s activity at the end of this experiment.</p>
</section>
<section id="stimulus-presentations">
<h2>Stimulus presentations<a class="headerlink" href="#stimulus-presentations" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">stimulus_presentations</span></code> table contains one entry for each stimulus that was presented during the session, along with important metadata including stimulus <code class="docutils literal notranslate"><span class="pre">start_time</span></code> and <code class="docutils literal notranslate"><span class="pre">end_time</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">image_name</span></code>, and whether the stimulus was an image change (<code class="docutils literal notranslate"><span class="pre">is_change</span></code> = True) or an image omission (<code class="docutils literal notranslate"><span class="pre">omitted</span></code> = True).</p>
<p>Get stimulus information for this experiment and assign it to a table called <code class="docutils literal notranslate"><span class="pre">stimulus_table</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_table</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">stimulus_table</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>duration</th>
      <th>end_frame</th>
      <th>flashes_since_change</th>
      <th>image_index</th>
      <th>image_name</th>
      <th>is_change</th>
      <th>omitted</th>
      <th>start_frame</th>
      <th>start_time</th>
      <th>end_time</th>
    </tr>
    <tr>
      <th>stimulus_presentations_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.25020</td>
      <td>18001.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>17986</td>
      <td>308.75313</td>
      <td>309.00333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.25020</td>
      <td>18046.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18031</td>
      <td>309.50374</td>
      <td>309.75394</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.25017</td>
      <td>18091.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18076</td>
      <td>310.25441</td>
      <td>310.50458</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.25026</td>
      <td>18136.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18121</td>
      <td>311.00496</td>
      <td>311.25522</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.25020</td>
      <td>18181.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18166</td>
      <td>311.75558</td>
      <td>312.00578</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.25021</td>
      <td>18226.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18211</td>
      <td>312.50620</td>
      <td>312.75641</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.25022</td>
      <td>18271.0</td>
      <td>6.0</td>
      <td>0</td>
      <td>im000</td>
      <td>False</td>
      <td>False</td>
      <td>18256</td>
      <td>313.25681</td>
      <td>313.50703</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.25020</td>
      <td>18316.0</td>
      <td>0.0</td>
      <td>6</td>
      <td>im031</td>
      <td>True</td>
      <td>False</td>
      <td>18301</td>
      <td>314.00741</td>
      <td>314.25761</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.25020</td>
      <td>18361.0</td>
      <td>1.0</td>
      <td>6</td>
      <td>im031</td>
      <td>False</td>
      <td>False</td>
      <td>18346</td>
      <td>314.75803</td>
      <td>315.00823</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.25019</td>
      <td>18406.0</td>
      <td>2.0</td>
      <td>6</td>
      <td>im031</td>
      <td>False</td>
      <td>False</td>
      <td>18391</td>
      <td>315.50864</td>
      <td>315.75883</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many stimuli were omitted?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This experiment had </span><span class="si">{}</span><span class="s1"> stimuli.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stimulus_table</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Out of all stimuli presented, </span><span class="si">{}</span><span class="s1"> were omitted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stimulus_table</span><span class="p">[</span><span class="n">stimulus_table</span><span class="p">[</span><span class="s1">&#39;image_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;omitted&#39;</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This experiment had 4797 stimuli.
Out of all stimuli presented, 160 were omitted.
</pre></div>
</div>
</div>
</div>
<p>dataframe columns:</p>
<dl class="simple myst">
<dt>stimulus_presentations_id [index]</dt><dd><p>(int) identifier for a stimulus presentation (presentation of an image)</p>
</dd>
<dt>start_time</dt><dd><p>(float) image presentation start time in seconds</p>
</dd>
<dt>end_time</dt><dd><p>(float) image presentation end time in seconds</p>
</dd>
<dt>image_name</dt><dd><p><em>str</em> Indicates which natural scene image stimulus was shown for this stimulus presentation.</p>
</dd>
<dt>image_index</dt><dd><p>(int) image index (0-7) for a given session, corresponding to each image name</p>
</dd>
<dt>is_change</dt><dd><p><em>bool</em> Indicates whether the image identity changed for this stimulus presentation</p>
</dd>
<dt>omitted</dt><dd><p>(bool) True if no image was shown for this stimulus presentation</p>
</dd>
<dt>trials_id</dt><dd><p>(int) Id to match to the table Index of the trials table.</p>
</dd>
<dt>flashes_since_change</dt><dd><p><em>float</em> Indicates how many flashes of the same image have occurred since the last stimulus change. NaN for blocks 1-4.</p>
</dd>
<dt>start_frame</dt><dd><p>(int) image presentation start frame</p>
</dd>
<dt>end_frame</dt><dd><p>(float) image presentation end frame</p>
</dd>
<dt>duration</dt><dd><p>(float) duration of an image presentation (flash) in seconds (stop_time - start_time). NaN if omitted</p>
</dd>
</dl>
</section>
<section id="stimulus-templates">
<h2>Stimulus templates<a class="headerlink" href="#stimulus-templates" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">stimulus_templates</span></code> attribute is a dataframe containing one row per stimulus shown during the change detection task. The index is the <code class="docutils literal notranslate"><span class="pre">image_name</span></code>. The columns contain numpy arrays of the stimuli that were shown during the session.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">unwarped</span></code> images represent the stimuli as they were seen by the mouse after correcting for distance from the mouse eye to the screen. The <code class="docutils literal notranslate"><span class="pre">warped</span></code> images show the exact image that was displayed on the stimulus monitor after spherical warping was applied to account for distance from the mouse’s eye.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_templates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unwarped</th>
      <th>warped</th>
    </tr>
    <tr>
      <th>image_name</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>im000</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[122, 122, 123, 125, 126, 127, 128, 129, 130,...</td>
    </tr>
    <tr>
      <th>im106</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[108, 109, 106, 103, 102, 104, 107, 112, 117,...</td>
    </tr>
    <tr>
      <th>im075</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[120, 121, 121, 121, 122, 123, 123, 122, 121,...</td>
    </tr>
    <tr>
      <th>im073</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[120, 120, 118, 116, 116, 119, 121, 120, 117,...</td>
    </tr>
    <tr>
      <th>im045</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[10, 13, 6, 0, 0, 8, 15, 13, 6, 2, 4, 9, 12, ...</td>
    </tr>
    <tr>
      <th>im054</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[124, 125, 127, 130, 133, 134, 136, 138, 140,...</td>
    </tr>
    <tr>
      <th>im031</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[233, 234, 244, 253, 253, 244, 237, 239, 246,...</td>
    </tr>
    <tr>
      <th>im035</th>
      <td>[[nan, nan, nan, nan, nan, nan, nan, nan, nan,...</td>
      <td>[[178, 181, 189, 198, 200, 198, 196, 199, 205,...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_templates</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_templates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">stimuli</span> <span class="o">=</span> <span class="n">stimulus_templates</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stimulus_templates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stimuli</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;unwarped&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fc62a74b460&gt;
</pre></div>
</div>
<img alt="../_images/f21ba89454e9e849247cfb5515163d595c8db790470d2f10f68b6c088bfdc46d.png" src="../_images/f21ba89454e9e849247cfb5515163d595c8db790470d2f10f68b6c088bfdc46d.png" />
</div>
</div>
</section>
<section id="stimulus-timestamps">
<h2>Stimulus timestamps<a class="headerlink" href="#stimulus-timestamps" title="Permalink to this heading">#</a></h2>
<p>All behavioral measurements (<code class="docutils literal notranslate"><span class="pre">running_speed</span></code>, <code class="docutils literal notranslate"><span class="pre">licks</span></code>, &amp; <code class="docutils literal notranslate"><span class="pre">rewards</span></code>) are made at the frequency of visual stimulus display (60Hz) and share frame times with the <code class="docutils literal notranslate"><span class="pre">stimulus_presentations</span></code>. You can use the frame index from any of the other behavior tables to determine the corresponding timestamp.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_timestamps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   8.74134,    8.75801,    8.77469, ..., 4510.21911, 4510.23578,
       4510.25249])
</pre></div>
</div>
</div>
</div>
</section>
<section id="lick-times">
<h2>Lick times<a class="headerlink" href="#lick-times" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">licks</span></code> attribute is a dataframe with one entry for every detected lick onset time, assigned the time of the corresponding visual stimulus frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">licks</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamps</th>
      <th>frame</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1603</th>
      <td>1269.05435</td>
      <td>75557</td>
    </tr>
    <tr>
      <th>348</th>
      <td>365.01579</td>
      <td>21359</td>
    </tr>
    <tr>
      <th>136</th>
      <td>262.14833</td>
      <td>15192</td>
    </tr>
    <tr>
      <th>2096</th>
      <td>1627.31374</td>
      <td>97035</td>
    </tr>
    <tr>
      <th>1557</th>
      <td>1214.42639</td>
      <td>72282</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="rewards">
<h2>Rewards<a class="headerlink" href="#rewards" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rewards</span></code> attribute is a dataframe containing one entry for every reward that was delivered, assigned the time of the corresponding visual stimulus frame. <code class="docutils literal notranslate"><span class="pre">auto_rewarded</span></code> is True if the reward was delivered without requiring a preceding lick. The first 5 change trials of each session are <code class="docutils literal notranslate"><span class="pre">auto_rewarded</span></code> = True.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>volume</th>
      <th>timestamps</th>
      <th>auto_rewarded</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26</th>
      <td>0.007</td>
      <td>1312.08948</td>
      <td>False</td>
    </tr>
    <tr>
      <th>48</th>
      <td>0.007</td>
      <td>1754.30080</td>
      <td>False</td>
    </tr>
    <tr>
      <th>64</th>
      <td>0.007</td>
      <td>2038.09937</td>
      <td>False</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.005</td>
      <td>314.14086</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.007</td>
      <td>1013.37880</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="running-speed">
<h2>Running speed<a class="headerlink" href="#running-speed" title="Permalink to this heading">#</a></h2>
<p>Mice are free to run on a circular disc during task performance. The <code class="docutils literal notranslate"><span class="pre">running_speed</span></code> table contains one entry for each read of the analog input line monitoring the encoder voltage, measured at 60 Hz. <code class="docutils literal notranslate"><span class="pre">running_speed</span></code> shares timestamps with the stimulus, provided in the <code class="docutils literal notranslate"><span class="pre">stimulus_timestamps</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamps</th>
      <th>speed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.74134</td>
      <td>-0.006992</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.75801</td>
      <td>0.389996</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.77469</td>
      <td>0.754625</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.79138</td>
      <td>1.057696</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.80804</td>
      <td>1.277703</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Plot the mouse’s <code class="docutils literal notranslate"><span class="pre">running_speed</span></code> for this experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_timestamps</span><span class="p">,</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">running_speed</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;running speed (cm/s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ophys_experiment_id :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ophys_experiment_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;ophys_experiment_id :957759570&#39;)
</pre></div>
</div>
<img alt="../_images/dc88b3b730cf69a3a91fa827c8633ef71a4728e4bb46bdf6506cf6b9786822d1.png" src="../_images/dc88b3b730cf69a3a91fa827c8633ef71a4728e4bb46bdf6506cf6b9786822d1.png" />
</div>
</div>
</section>
<section id="eye-tracking">
<h2>Eye tracking<a class="headerlink" href="#eye-tracking" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">eye_tracking</span></code> table containing ellipse fit parameters for the eye, pupil and corneal reflection (cr). Fits are derived from tracking points from a DeepLabCut model applied to video frames of the mouse’s right eye (collected at 60hz). The <code class="docutils literal notranslate"><span class="pre">pupil_area</span></code> is the total area, in pixels, of the ellipse fit.</p>
<p>The corneal reflection (cr) fit can be used to estimate the axis of the camera. Taking the difference between the corneal reflection position and the pupil position can therefore disambiguate translations of the entire eye (in which case both the cr and pupil will shift together) from rotations of the eye (in which case the pupil position will move relative to the corneal reflection).</p>
<p>Examine the <code class="docutils literal notranslate"><span class="pre">eye_tracking</span></code> table</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">eye_tracking</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>timestamps</th>
      <th>cr_area</th>
      <th>eye_area</th>
      <th>pupil_area</th>
      <th>likely_blink</th>
      <th>pupil_area_raw</th>
      <th>cr_area_raw</th>
      <th>eye_area_raw</th>
      <th>cr_center_x</th>
      <th>cr_center_y</th>
      <th>...</th>
      <th>eye_center_x</th>
      <th>eye_center_y</th>
      <th>eye_width</th>
      <th>eye_height</th>
      <th>eye_phi</th>
      <th>pupil_center_x</th>
      <th>pupil_center_y</th>
      <th>pupil_width</th>
      <th>pupil_height</th>
      <th>pupil_phi</th>
    </tr>
    <tr>
      <th>frame</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.17278</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>True</td>
      <td>23212.800552</td>
      <td>98.711757</td>
      <td>64631.264284</td>
      <td>348.546244</td>
      <td>279.151509</td>
      <td>...</td>
      <td>360.406224</td>
      <td>259.823698</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>351.118771</td>
      <td>268.126167</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.20753</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>True</td>
      <td>23268.865872</td>
      <td>98.428380</td>
      <td>64589.149589</td>
      <td>348.537688</td>
      <td>279.138556</td>
      <td>...</td>
      <td>360.304902</td>
      <td>260.023828</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>351.379090</td>
      <td>268.190725</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.20986</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>True</td>
      <td>23322.880481</td>
      <td>108.124556</td>
      <td>64667.735921</td>
      <td>348.776906</td>
      <td>278.763494</td>
      <td>...</td>
      <td>360.768207</td>
      <td>258.962922</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>350.680601</td>
      <td>268.043758</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.24332</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>True</td>
      <td>23465.541426</td>
      <td>109.606476</td>
      <td>64536.922664</td>
      <td>348.503846</td>
      <td>278.154595</td>
      <td>...</td>
      <td>361.383089</td>
      <td>258.391708</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>351.469294</td>
      <td>268.284240</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.28209</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>True</td>
      <td>23404.595038</td>
      <td>106.169282</td>
      <td>64285.566594</td>
      <td>348.358439</td>
      <td>277.939624</td>
      <td>...</td>
      <td>360.861868</td>
      <td>257.989534</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>351.004937</td>
      <td>268.315566</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div></div></div>
</div>
<p>dataframe columns:</p>
<dl class="simple myst">
<dt>frame (index)</dt><dd><p>(int) frame of eye tracking video.</p>
</dd>
<dt>timestamps</dt><dd><p>(float) experiment timestamp for frame in seconds</p>
</dd>
<dt>cr_area</dt><dd><p>(float) area of corneal reflection ellipse in pixels squared</p>
</dd>
<dt>eye_area</dt><dd><p>(float) area of eye ellipse in pixels squared</p>
</dd>
<dt>pupil_area</dt><dd><p>(float) area of pupil ellipse in pixels squared</p>
</dd>
<dt>likely_blink</dt><dd><p>(bool) True if frame has outlier ellipse fits, which is often caused by blinking / squinting of the eye.</p>
</dd>
<dt>eye_area_raw</dt><dd><p>(float) pupil area with no outliers/likely blinks removed.</p>
</dd>
<dt>eye_center_x</dt><dd><p>(float) center of eye ellipse on x axis in pixels</p>
</dd>
<dt>eye_center_y</dt><dd><p>(float) center of eye ellipse on y axis in pixels</p>
</dd>
<dt>eye_height</dt><dd><p>(float) eye height (minor axis of the eye ellipse) in pixels</p>
</dd>
<dt>eye_width</dt><dd><p>(float) eye width (major axis of the eye ellipse) in pixels</p>
</dd>
<dt>eye_phi</dt><dd><p>(float) eye rotation angle in radians</p>
</dd>
<dt>pupil_area_raw</dt><dd><p>(float) pupil area with no outliers/likely blinks removed.</p>
</dd>
<dt>pupil_center_x</dt><dd><p>(float) center of pupil ellipse on x axis in pixels</p>
</dd>
<dt>pupil_center_y</dt><dd><p>(float) center of pupil ellipse on y axis in pixels</p>
</dd>
<dt>pupil_height</dt><dd><p>(float) pupil height (minor axis of the pupil ellipse) in pixels</p>
</dd>
<dt>pupil_width</dt><dd><p>(float) pupil width (major axis of the pupil ellipse) in pixels</p>
</dd>
<dt>pupil_phi</dt><dd><p>(float) pupil rotation angle in radians</p>
</dd>
<dt>cr_area_raw</dt><dd><p>(float) corneal reflection area with no outliers/likely blinks removed.</p>
</dd>
<dt>cr_center_x</dt><dd><p>(float) center of corneal reflection on x axis in pixels</p>
</dd>
<dt>cr_center_y</dt><dd><p>(float) center of corneal reflection on y axis in pixels</p>
</dd>
<dt>cr_height</dt><dd><p>(float) corneal reflection height (minor axis of the CR ellipse) in pixels</p>
</dd>
<dt>cr_width</dt><dd><p>(float) corneal reflection width (major axis of the CR ellipse) in pixels</p>
</dd>
<dt>cr_phi</dt><dd><p>(float) corneal reflection rotation angle in radians</p>
</dd>
</dl>
<p>Plot the pupil_area for this experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">eye_tracking</span><span class="o">.</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">eye_tracking</span><span class="o">.</span><span class="n">pupil_area</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pupil area (pixels^2)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ophys_experiment_id :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ophys_experiment_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;ophys_experiment_id :957759570&#39;)
</pre></div>
</div>
<img alt="../_images/297cde5517e307e54a5ee6c760541c5010c3616602f4a15dee93e98fde78c710.png" src="../_images/297cde5517e307e54a5ee6c760541c5010c3616602f4a15dee93e98fde78c710.png" />
</div>
</div>
</section>
<section id="task-parameters">
<h2>Task parameters<a class="headerlink" href="#task-parameters" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">task_parameters</span></code> attribute contains information about the struture of the behavior task for that specific session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">task_parameters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;auto_reward_volume&#39;: 0.005,
 &#39;blank_duration_sec&#39;: [0.5, 0.5],
 &#39;n_stimulus_frames&#39;: 69575,
 &#39;omitted_flash_fraction&#39;: 0.05,
 &#39;response_window_sec&#39;: [0.15, 0.75],
 &#39;reward_volume&#39;: 0.007,
 &#39;session_type&#39;: &#39;OPHYS_4_images_B&#39;,
 &#39;stimulus&#39;: &#39;images&#39;,
 &#39;stimulus_distribution&#39;: &#39;geometric&#39;,
 &#39;stimulus_duration_sec&#39;: 0.25,
 &#39;task&#39;: &#39;change detection&#39;}
</pre></div>
</div>
</div>
</div>
<p>Here we can see that the <code class="docutils literal notranslate"><span class="pre">stimulus_duration_sec</span></code> is 0.25 seconds and the <code class="docutils literal notranslate"><span class="pre">blank_duration_sec</span></code> is 0.5 seconds. This determines the inter-stimulus interval.</p>
<p>dataframe columns:</p>
<dl class="simple myst">
<dt>auto_reward_volume</dt><dd><p>(float) Volume of auto rewards in ml.</p>
</dd>
<dt>blank_duration_sec</dt><dd><p>(list of floats) Duration in seconds of inter stimulus interval. Inter-stimulus interval chosen as a uniform random value between the range defined by the two values. Values are ignored if <code class="docutils literal notranslate"><span class="pre">stimulus_duration_sec</span></code> is null.</p>
</dd>
<dt>response_window_sec</dt><dd><p>(list of floats) Range of period following an image change, in seconds, where mouse response influences trial outcome. First value represents response window start. Second value represents response window end. Values represent time before display lag is accounted for and applied.</p>
</dd>
<dt>n_stimulus_frames</dt><dd><p>(int) Total number of visual stimulus frames presented during a behavior session.</p>
</dd>
<dt>task</dt><dd><p>(string) Type of behavioral task (‘change_detection’ for this dataset)</p>
</dd>
<dt>session_type</dt><dd><p>(string) Visual stimulus type run during behavior session.</p>
</dd>
<dt>omitted_flash_fraction</dt><dd><p>(float) Probability that a stimulus image presentations is omitted. Change stimuli, and the stimulus immediately preceding the change, are never omitted.</p>
</dd>
<dt>stimulus_distribution</dt><dd><p>(string) Distribution for drawing change times. Either ‘exponential’ or ‘geometric’.</p>
</dd>
<dt>stimulus_duration_sec</dt><dd><p>(float) Duration in seconds of each stimulus image presentation</p>
</dd>
<dt>reward_volume</dt><dd><p>(float) Volume of earned water reward in ml.</p>
</dd>
<dt>stimulus</dt><dd><p>(string) Stimulus type (‘gratings’ or ‘images’).</p>
</dd>
</dl>
</section>
<section id="trials">
<h2>Trials<a class="headerlink" href="#trials" title="Permalink to this heading">#</a></h2>
<p>While the <code class="docutils literal notranslate"><span class="pre">stimulus_presentations</span></code> table has one entry for each individual stimulus that was presented, the <code class="docutils literal notranslate"><span class="pre">trials</span></code> table contains one entry for each behavioral trial, which consists of a series of stimulus presentations and is defined by the <code class="docutils literal notranslate"><span class="pre">change_time</span></code>.</p>
<p>On a given trial, a <code class="docutils literal notranslate"><span class="pre">change_time</span></code> is selected from a geometric distribution between 4 and 12 flashes after the time of the last change or the last lick.</p>
<p>On <code class="docutils literal notranslate"><span class="pre">go</span></code> trials, the image identity will change at the selected <code class="docutils literal notranslate"><span class="pre">change_time</span></code>. If the mouse licks within the response window (see <code class="docutils literal notranslate"><span class="pre">response_window_sec</span></code> entry of the `task_parameters attribute), that is considered a hit and a reward will be delivered. If the mouse fails to lick after the change, the trial is considered a miss.</p>
<p>On <code class="docutils literal notranslate"><span class="pre">catch</span></code> trials, a <code class="docutils literal notranslate"><span class="pre">change_time</span></code> is drawn, but the image identity does not change. If the mouse licks within the reward window, this is a false alarm and no reward is delivered. Correctly witholding a lick is called a correct reject.</p>
<p>This definition of a <code class="docutils literal notranslate"><span class="pre">catch</span></code> trial is a conservative one, and only consideres the non-change stimulus presentations that are drawn from the same distribution as the change times. A less restrictive definition could consider every non-change stimulus presentation as a catch trial, and the false alarm rate can be computed this way as well.</p>
<p>If the mouse licks prior to the scheduled <code class="docutils literal notranslate"><span class="pre">change_time</span></code>, the trial is <code class="docutils literal notranslate"><span class="pre">aborted</span></code> and starts over again, using the same <code class="docutils literal notranslate"><span class="pre">change_time</span></code> for up to 5 trials in a row. This is to discourage mice from licking frequently, as they have to wait until the change time to get a reward.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># look at 5 random trials</span>
<span class="n">ophys_experiment</span><span class="o">.</span><span class="n">trials</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>stop_time</th>
      <th>lick_times</th>
      <th>reward_time</th>
      <th>reward_volume</th>
      <th>hit</th>
      <th>false_alarm</th>
      <th>miss</th>
      <th>is_change</th>
      <th>aborted</th>
      <th>...</th>
      <th>catch</th>
      <th>auto_rewarded</th>
      <th>correct_reject</th>
      <th>trial_length</th>
      <th>response_time</th>
      <th>change_frame</th>
      <th>change_time</th>
      <th>response_latency</th>
      <th>initial_image_name</th>
      <th>change_image_name</th>
    </tr>
    <tr>
      <th>trials_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>589</th>
      <td>3460.29471</td>
      <td>3468.31793</td>
      <td>[]</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>8.02322</td>
      <td>NaN</td>
      <td>207149.0</td>
      <td>3464.083778</td>
      <td>inf</td>
      <td>im000</td>
      <td>im073</td>
    </tr>
    <tr>
      <th>453</th>
      <td>2390.45396</td>
      <td>2391.15453</td>
      <td>[2390.83757]</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>0.70057</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>im035</td>
      <td>im035</td>
    </tr>
    <tr>
      <th>554</th>
      <td>3137.44764</td>
      <td>3145.47085</td>
      <td>[]</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>8.02321</td>
      <td>NaN</td>
      <td>187794.0</td>
      <td>3141.236688</td>
      <td>inf</td>
      <td>im031</td>
      <td>im075</td>
    </tr>
    <tr>
      <th>636</th>
      <td>3874.73332</td>
      <td>3882.75657</td>
      <td>[]</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>8.02325</td>
      <td>NaN</td>
      <td>231995.0</td>
      <td>3878.522378</td>
      <td>inf</td>
      <td>im035</td>
      <td>im031</td>
    </tr>
    <tr>
      <th>596</th>
      <td>3518.09194</td>
      <td>3525.36455</td>
      <td>[]</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>7.27261</td>
      <td>NaN</td>
      <td>210569.0</td>
      <td>3521.130378</td>
      <td>inf</td>
      <td>im073</td>
      <td>im106</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<p>dataframe columns:</p>
<dl class="simple myst">
<dt>start_time</dt><dd><p>(float) Experiment time when this trial began in seconds.</p>
</dd>
<dt>stop_time</dt><dd><p>(float) Experiment time when this trial ended.</p>
</dd>
<dt>lick_times</dt><dd><p>(float array) A list indicating when the behavioral control software recognized a lick. Note that this is not identical to the lick times from the licks dataframe, which record when the licks were registered by the lick sensor. The licks dataframe should generally be used for analysis of the licking behavior rather than these times.</p>
</dd>
<dt>reward_time</dt><dd><p>(float) Indicates when the reward command was triggered for hit trials. NaN for other trial types.</p>
</dd>
<dt>reward_volume</dt><dd><p>(float) Indicates the volume of water dispensed as reward for this trial.</p>
</dd>
<dt>is_change</dt><dd><p>(bool) Indicates whether an image change occurred for this trial.</p>
</dd>
<dt>change_time</dt><dd><p>(float) The time when the change in image identity occurs. This change time is used to determine the response window during which a lick will trigger a reward.</p>
</dd>
<dt>change_frame</dt><dd><p>(int) Indicates the stimulus frame index when the change (on go trials) or sham change (on catch trials) occurred. This column can be used to link the trials table with the stimulus presentations table, as shown below.</p>
</dd>
<dt>go</dt><dd><p>(bool) Indicates whether this trial was a ‘go’ trial. To qualify as a go trial, an image change must occur and the trial cannot be autorewarded.</p>
</dd>
<dt>catch</dt><dd><p>(bool) Indicates whether this trial was a ‘catch’ trial. To qualify as a catch trial, a ‘sham’ change must occur during which the image identity does not change. These sham changes are drawn to match the timing distribution of real changes and can be used to calculate the false alarm rate.</p>
</dd>
<dt>hit</dt><dd><p>(bool) Indicates whether this trial was a ‘hit’ trial. To qualify as a hit, the trial must be a go trial during which the stimulus changed and the mouse licked within the reward window (150-750 ms after the change time).</p>
</dd>
<dt>false_alarm</dt><dd><p>(bool) Indicates whether this trial was a ‘false alarm’ trial. To qualify as a false alarm, the trial must be a catch trial during which a sham change occurred and the mouse licked during the reward window.</p>
</dd>
<dt>miss</dt><dd><p>(bool) To qualify as a miss trial, the trial must be a go trial during which the stimulus changed but the mouse did not lick within the response window.</p>
</dd>
<dt>correct_reject</dt><dd><p>(bool) To qualify as a correct reject trial, the trial must be a catch trial during which a sham change occurred and the mouse withheld licking.</p>
</dd>
<dt>aborted</dt><dd><p>(bool) A trial is aborted when the mouse licks before the scheduled change or sham change.</p>
</dd>
<dt>auto_rewarded</dt><dd><p>(bool) During autorewarded trials, the reward is automatically triggered after the change regardless of whether the mouse licked within the response window. These always come at the beginning of the session to help engage the mouse in behavior.</p>
</dd>
<dt>initial_image_name</dt><dd><p>(float) Indicates which image was shown before the change (or sham change) for this trial</p>
</dd>
<dt>change_image_name</dt><dd><p>(string) Indicates which image was scheduled to be the change image for this trial. Note that if the trial is aborted, a new trial will begin before this change occurs.</p>
</dd>
<dt>trial_length</dt><dd><p>(float) Duration of the trial in seconds.</p>
</dd>
<dt>response_time</dt><dd><p>(float) Indicates the time when the first lick was registered by the task control software for trials that were not aborted (go or catch). NaN for aborted trials. For a more accurate measure of response time, the licks dataframe should be used.</p>
</dd>
</dl>
</section>
<section id="performance-metrics">
<h2>Performance metrics<a class="headerlink" href="#performance-metrics" title="Permalink to this heading">#</a></h2>
<p>One useful method of the <code class="docutils literal notranslate"><span class="pre">ophys_experiment</span></code> object is the <code class="docutils literal notranslate"><span class="pre">get_performance_metrics</span></code> method, which returns some summary metrics on the session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get behavior performance metrics for one session</span>
<span class="n">ophys_experiment</span><span class="o">.</span><span class="n">get_performance_metrics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;trial_count&#39;: 640,
 &#39;go_trial_count&#39;: 252,
 &#39;catch_trial_count&#39;: 35,
 &#39;hit_trial_count&#39;: 70,
 &#39;miss_trial_count&#39;: 182,
 &#39;false_alarm_trial_count&#39;: 2,
 &#39;correct_reject_trial_count&#39;: 33,
 &#39;auto_reward_count&#39;: 5,
 &#39;earned_reward_count&#39;: 70,
 &#39;total_reward_count&#39;: 75,
 &#39;total_reward_volume&#39;: 0.515,
 &#39;maximum_reward_rate&#39;: 4.3130202342807245,
 &#39;engaged_trial_count&#39;: 212,
 &#39;mean_hit_rate&#39;: 0.4252895970233363,
 &#39;mean_hit_rate_uncorrected&#39;: 0.4256732205557432,
 &#39;mean_hit_rate_engaged&#39;: 0.872856714153381,
 &#39;mean_false_alarm_rate&#39;: 0.11763102364147658,
 &#39;mean_false_alarm_rate_uncorrected&#39;: 0.07070533028721182,
 &#39;mean_false_alarm_rate_engaged&#39;: 0.1913937670516618,
 &#39;mean_dprime&#39;: 0.823586586603706,
 &#39;mean_dprime_engaged&#39;: 2.0336866686070554,
 &#39;max_dprime&#39;: 2.5554209406856407,
 &#39;max_dprime_engaged&#39;: 2.5554209406856407}
</pre></div>
</div>
</div>
</div>
<p>You can also access performing metrics computed on a rolling basis across trials using the <code class="docutils literal notranslate"><span class="pre">get_rolling_performance_df</span></code> method. The rolling performance metrics share timestamps with the <code class="docutils literal notranslate"><span class="pre">change_time</span></code>s of the <code class="docutils literal notranslate"><span class="pre">trials</span></code> table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">get_rolling_performance_df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reward_rate</th>
      <th>hit_rate_raw</th>
      <th>hit_rate</th>
      <th>false_alarm_rate_raw</th>
      <th>false_alarm_rate</th>
      <th>rolling_dprime</th>
    </tr>
    <tr>
      <th>trials_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>635</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005747</td>
      <td>0.0</td>
      <td>0.038462</td>
      <td>-0.557523</td>
    </tr>
    <tr>
      <th>636</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005682</td>
      <td>0.0</td>
      <td>0.041667</td>
      <td>-0.594683</td>
    </tr>
    <tr>
      <th>637</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005682</td>
      <td>0.0</td>
      <td>0.041667</td>
      <td>-0.594683</td>
    </tr>
    <tr>
      <th>638</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005682</td>
      <td>0.0</td>
      <td>0.041667</td>
      <td>-0.594683</td>
    </tr>
    <tr>
      <th>639</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.005682</td>
      <td>0.0</td>
      <td>0.041667</td>
      <td>-0.594683</td>
    </tr>
  </tbody>
</table>
<p>640 rows × 6 columns</p>
</div></div></div>
</div>
<p>Plot the reward rate over time during the session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">performance_df</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">get_rolling_performance_df</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ophys_experiment</span><span class="o">.</span><span class="n">trials</span><span class="o">.</span><span class="n">change_time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">performance_df</span><span class="o">.</span><span class="n">reward_rate</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc629cb18b0&gt;]
</pre></div>
</div>
<img alt="../_images/7c76a1979c2f3ad34d7ede4cbdba99884671234607cf1f1d5cd2b255c1c1b6b0.png" src="../_images/7c76a1979c2f3ad34d7ede4cbdba99884671234607cf1f1d5cd2b255c1c1b6b0.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="plot-example-cell-activity-with-stimuli-and-behavior">
<h1>Plot example cell activity with stimuli and behavior<a class="headerlink" href="#plot-example-cell-activity-with-stimuli-and-behavior" title="Permalink to this heading">#</a></h1>
<p>We can select a cell from the experiment and plot it’s <code class="docutils literal notranslate"><span class="pre">dff_traces</span></code> and <code class="docutils literal notranslate"><span class="pre">events</span></code> traces along with other behavioral and stimulus data, including <code class="docutils literal notranslate"><span class="pre">running_speed</span></code>, <code class="docutils literal notranslate"><span class="pre">pupil_area</span></code>, as well as stimulus timing using the <code class="docutils literal notranslate"><span class="pre">stimulus_presentations</span></code> table.</p>
<p>Below we will put together plotting functions that utilize data from the <code class="docutils literal notranslate"><span class="pre">ophys_experiment</span></code> object to plot ophys traces and behavioral data from the experiment.</p>
<p>First, get stimulus information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a list of all unique stimuli presented in this experiment</span>
<span class="n">unique_stimuli</span> <span class="o">=</span> <span class="p">[</span><span class="n">stimulus</span> <span class="k">for</span> <span class="n">stimulus</span> <span class="ow">in</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;image_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="c1"># create a colormap with each unique image having its own color</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span><span class="n">image_name</span><span class="p">:</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="n">image_number</span><span class="p">]</span> <span class="k">for</span> <span class="n">image_number</span><span class="p">,</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_stimuli</span><span class="p">))}</span>
<span class="n">colormap</span><span class="p">[</span><span class="s1">&#39;omitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># set omitted stimulus to white color</span>

<span class="c1"># add the colors for each image to the stimulus presentations table in the dataset</span>
<span class="n">stimulus_presentations</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span>
<span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;image_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">colormap</span><span class="p">[</span><span class="n">image_name</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Here are some plotting functions for convenience.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to plot dff traces</span>
<span class="k">def</span> <span class="nf">plot_dff_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cell_specimen_id</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        ax: axis on which to plot</span>
<span class="sd">        cell_specimen_id: id of the cell to plot</span>
<span class="sd">        intial_time: initial time to plot from</span>
<span class="sd">        final_time: final time to plot to</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#create a dataframe using dff trace from one seleted cell</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dff&#39;</span><span class="p">:</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">dff_traces</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cell_specimen_id</span><span class="p">][</span><span class="s1">&#39;dff&#39;</span><span class="p">],</span>
        <span class="s1">&#39;timestamps&#39;</span><span class="p">:</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dff_trace_sample</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dff_trace_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">dff_trace_sample</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dff_trace_sample</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># function to plot events traces</span>
<span class="k">def</span> <span class="nf">plot_events_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">cell_specimen_id</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="c1"># create a dataframe using events trace from one seleted cell</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cell_specimen_id</span><span class="p">]</span><span class="o">.</span><span class="n">events</span><span class="p">,</span>
        <span class="s1">&#39;timestamps&#39;</span><span class="p">:</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">ophys_timestamps</span><span class="p">}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">events_trace_sample</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">events_trace_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">events_trace_sample</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">events_trace_sample</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># function to plot running speed</span>
<span class="k">def</span> <span class="nf">plot_running</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="n">running_sample</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">running_speed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">running_sample</span> <span class="o">=</span> <span class="n">running_sample</span><span class="p">[(</span><span class="n">running_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">running_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">running_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">running_sample</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">running_sample</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># function to plot pupil diameter</span>
<span class="k">def</span> <span class="nf">plot_pupil</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="n">pupil_sample</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">eye_tracking</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">pupil_sample</span> <span class="o">=</span> <span class="n">pupil_sample</span><span class="p">[(</span><span class="n">pupil_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">pupil_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pupil_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">pupil_sample</span><span class="p">[</span><span class="s1">&#39;pupil_width&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">pupil_sample</span><span class="p">[</span><span class="s1">&#39;pupil_width&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># function to plot licks</span>
<span class="k">def</span> <span class="nf">plot_licks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="n">licking_sample</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">licks</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">licking_sample</span> <span class="o">=</span> <span class="n">licking_sample</span><span class="p">[(</span><span class="n">licking_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">licking_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">licking_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">licking_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]),</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="c1"># function to plot rewards</span>
<span class="k">def</span> <span class="nf">plot_rewards</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="n">rewards_sample</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">rewards_sample</span> <span class="o">=</span> <span class="n">rewards_sample</span><span class="p">[(</span><span class="n">rewards_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span>
                                    <span class="p">(</span><span class="n">rewards_sample</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rewards_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rewards_sample</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]),</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># function to plot stimuli</span>
<span class="k">def</span> <span class="nf">plot_stimuli</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">):</span>
    <span class="n">stimulus_presentations_sample</span> <span class="o">=</span> <span class="n">stimulus_presentations</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">stimulus_presentations_sample</span> <span class="o">=</span> <span class="n">stimulus_presentations_sample</span><span class="p">[(</span><span class="n">stimulus_presentations_sample</span><span class="o">.</span><span class="n">end_time</span> <span class="o">&gt;=</span> <span class="n">initial_time</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">stimulus_presentations_sample</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&lt;=</span> <span class="n">final_time</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">stimulus</span> <span class="ow">in</span> <span class="n">stimulus_presentations_sample</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">stimulus</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">],</span> <span class="n">stimulus</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">stimulus</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="create-the-plot-for-one-cell">
<h2>Create the plot for one cell<a class="headerlink" href="#create-the-plot-for-one-cell" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_time</span> <span class="o">=</span> <span class="mi">820</span> <span class="c1"># start time in seconds</span>
<span class="n">final_time</span> <span class="o">=</span> <span class="mi">860</span> <span class="c1"># stop time in seconds</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plot_dff_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell_specimen_ids</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_events_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell_specimen_ids</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_stimuli</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;normalized response magnitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;dff trace&#39;</span><span class="p">,</span> <span class="s1">&#39;events trace&#39;</span><span class="p">])</span>

<span class="n">plot_running</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_pupil</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_licks</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_rewards</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_stimuli</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;running speed&#39;</span><span class="p">,</span> <span class="s1">&#39;pupil&#39;</span><span class="p">,</span><span class="s1">&#39;licks&#39;</span><span class="p">,</span> <span class="s1">&#39;rewards&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc6299909d0&gt;
</pre></div>
</div>
<img alt="../_images/8db231d9693c7e7c2caa25946d326b48efa4d8b555d9a1b0ef529d9f62851869.png" src="../_images/8db231d9693c7e7c2caa25946d326b48efa4d8b555d9a1b0ef529d9f62851869.png" />
</div>
</div>
<p>From looking at the activity of this neuron, we can see that it was very active during our experiment but its activity does not appear to be reliably locked to image presentations. It does seem to vaguely follow animal’s running speed, thus it might be modulated by running.</p>
</section>
<section id="create-the-same-plot-for-a-vip-cell-from-a-different-experiment">
<h2>Create the same plot for a Vip cell from a different experiment<a class="headerlink" href="#create-the-same-plot-for-a-vip-cell-from-a-different-experiment" title="Permalink to this heading">#</a></h2>
<p>We can get a different, Vip experiment from <code class="docutils literal notranslate"><span class="pre">session_type</span></code> = <code class="docutils literal notranslate"><span class="pre">OPHYS_1</span></code> (equivalent to <code class="docutils literal notranslate"><span class="pre">session_number</span></code> = 1) and plot it to compare response traces. This gives us a similar plot from a different inhibitory neuron to compare their neural dynamics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a Vip experiment with familiar images (session_number = 1, 2, or 3)</span>
<span class="n">selected_experiment_table</span> <span class="o">=</span> <span class="n">ophys_experiment_table</span><span class="p">[(</span><span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">cre_line</span><span class="o">==</span><span class="s1">&#39;Vip-IRES-Cre&#39;</span><span class="p">)</span><span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">ophys_experiment_table</span><span class="o">.</span><span class="n">session_number</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>

<span class="c1"># load the experiment data from the cache</span>
<span class="n">ophys_experiment</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_behavior_ophys_experiment</span><span class="p">(</span><span class="n">selected_experiment_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># get the cell IDs</span>
<span class="n">cell_specimen_ids</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">cell_specimen_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="c1"># a list of all cell ids</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/envs/allensdk/lib/python3.8/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace &#39;hdmf-common&#39; version 1.3.0 because version 1.5.1 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
/opt/envs/allensdk/lib/python3.8/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace &#39;core&#39; version 2.2.5 because version 2.5.0 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a list of all unique stimuli presented in this experiment</span>
<span class="n">unique_stimuli</span> <span class="o">=</span> <span class="p">[</span><span class="n">stimulus</span> <span class="k">for</span> <span class="n">stimulus</span> <span class="ow">in</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;image_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="c1"># create a colormap with each unique image having its own color</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span><span class="n">image_name</span><span class="p">:</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()[</span><span class="n">image_number</span><span class="p">]</span> <span class="k">for</span> <span class="n">image_number</span><span class="p">,</span> <span class="n">image_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_stimuli</span><span class="p">))}</span>
<span class="n">colormap</span><span class="p">[</span><span class="s1">&#39;omitted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add the colors for each image to the stimulus presentations table in the dataset</span>
<span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ophys_experiment</span><span class="o">.</span><span class="n">stimulus_presentations</span><span class="p">[</span><span class="s1">&#39;image_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">image_name</span><span class="p">:</span> <span class="n">colormap</span><span class="p">[</span><span class="n">image_name</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can plot the same information for a different cell in the dataset</span>
<span class="n">initial_time</span> <span class="o">=</span> <span class="mi">580</span> <span class="c1"># start time in seconds</span>
<span class="n">final_time</span> <span class="o">=</span> <span class="mi">620</span> <span class="c1"># stop time in seconds</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plot_dff_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell_specimen_ids</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_events_trace</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell_specimen_ids</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_stimuli</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;normalized response magnitude&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;dff trace&#39;</span><span class="p">,</span> <span class="s1">&#39;events trace&#39;</span><span class="p">])</span>

<span class="n">plot_running</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_pupil</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_licks</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_rewards</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>
<span class="n">plot_stimuli</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial_time</span><span class="p">,</span> <span class="n">final_time</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;running speed&#39;</span><span class="p">,</span> <span class="s1">&#39;pupil&#39;</span><span class="p">,</span><span class="s1">&#39;licks&#39;</span><span class="p">,</span> <span class="s1">&#39;rewards&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc61c8d4040&gt;
</pre></div>
</div>
<img alt="../_images/5b9fc5a5f278a7f2179dcc0803d9a9ef3e75b044c4cf9afcb8268b08285d37a7.png" src="../_images/5b9fc5a5f278a7f2179dcc0803d9a9ef3e75b044c4cf9afcb8268b08285d37a7.png" />
</div>
</div>
<p>We can see that the dynamics of a Vip neuron are also not driven by the visual stimuli. Aligning neural activity to different behavioral or experimental events might reveal what this neuron is driven by.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "allensdk"
        },
        kernelOptions: {
            name: "allensdk",
            path: "./visual-behavior"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'allensdk'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="VBO-Dataset.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Visual Behavior Ophys Dataset</p>
      </div>
    </a>
    <a class="right-next"
       href="VBO-Tutorial-Compare_trial_types.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Compare Trial Types</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Visual Behavior Ophys Experiment Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-cache-and-get-metadata-tables">Load the cache and get metadata tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-the-ophys-experiment-table-to-identify-experiments-of-interest">Filter the <code class="docutils literal notranslate"><span class="pre">ophys_experiment_table</span></code> to identify experiments of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data-for-one-experiment">Load data for one experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-metadata">Experiment metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#max-projection-image">Max projection image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-projection">Average projection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-specimen-table">Cell specimen table</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#segmentation-mask-image">Segmentation mask image</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-activity-traces">Cell activity traces</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#df-f-traces">dF/F traces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#events">Events</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ophys-timestamps">Ophys timestamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-presentations">Stimulus presentations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-templates">Stimulus templates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stimulus-timestamps">Stimulus timestamps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lick-times">Lick times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rewards">Rewards</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-speed">Running speed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eye-tracking">Eye tracking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-parameters">Task parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trials">Trials</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-metrics">Performance metrics</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-example-cell-activity-with-stimuli-and-behavior">Plot example cell activity with stimuli and behavior</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-plot-for-one-cell">Create the plot for one cell</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-same-plot-for-a-vip-cell-from-a-different-experiment">Create the same plot for a Vip cell from a different experiment</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Saskia de Vries, Marina Garrett, Corbett Bennett, Galen Lynch, Anna Lakunina, Casey Schneider-Mizell
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>